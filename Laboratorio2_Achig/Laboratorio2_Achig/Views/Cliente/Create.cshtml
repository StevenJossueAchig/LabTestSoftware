@model Laboratorio2_Achig.Models.ClienteSql

@{
    ViewData["Title"] = "Crear";
}

<!-- Encabezado de contenido -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">Crear Cliente</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active">Crear Cliente</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>

<!-- Formulario para crear cliente -->
<form asp-action="Create">
    <section class="content">
        <div class="container-fluid">
            <div class="card card-secondary">
                <div class="card-header">
                    <h3 class="card-title">Agregar Cliente</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>

                <div class="card-body">
                    <div class="form-group">
                        <label for="provincia">Provincia</label>
                        <select asp-for="Provincia" class="form-control" id="provincia" name="Provincia" onchange="generarCedula()">
                            <option value="">Seleccione una provincia</option>
                            <option value="01">Azuay</option>
                            <option value="02">Bolívar</option>
                            <option value="03">Cañar</option>
                            <option value="04">Carchi</option>
                            <option value="05">Cotopaxi</option>
                            <option value="06">Chimborazo</option>
                            <option value="07">El Oro</option>
                            <option value="08">Esmeraldas</option>
                            <option value="09">Guayas</option>
                            <option value="10">Imbabura</option>
                            <option value="11">Loja</option>
                            <option value="12">Los Ríos</option>
                            <option value="13">Manabí</option>
                            <option value="14">Morona Santiago</option>
                            <option value="15">Napo</option>
                            <option value="16">Pastaza</option>
                            <option value="17">Pichincha</option>
                            <option value="18">Tungurahua</option>
                            <option value="19">Zamora Chinchipe</option>
                            <option value="20">Galápagos</option>
                            <option value="21">Sucumbíos</option>
                            <option value="22">Orellana</option>
                            <option value="23">Santo Domingo de los Tsáchilas</option>
                            <option value="24">Santa Elena</option>
                            <option value="30">Número reservado para ecuatorianos registrados en el exterior</option>
                        </select>
                        <span asp-validation-for="Provincia" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label for="cedula">Cédula</label>
                        <input type="text" name="Cedula" class="form-control" id="cedula" value="@Model.Cedula" placeholder="Cédula" maxlength="10" readonly>
                    </div>

                    <div class="form-group">
                        <label for="apellidos">Apellidos</label>
                        <input type="text" name="Apellidos" class="form-control" id="apellidos" value="@Model.Apellidos" placeholder="Apellidos" maxlength="50"
                               pattern="[A-Za-z\s]*" title="Los apellidos solo deben contener letras y espacios. No puede contener números ni caracteres especiales."
                               oninput="validateApellidos(this)" required>
                        <span asp-validation-for="Apellidos" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label for="nombres">Nombres</label>
                        <input type="text" name="Nombres" class="form-control" id="nombres" value="@Model.Nombres" placeholder="Nombres" maxlength="50"
                               pattern="[A-Za-z\s]*" title="Los nombres solo deben contener letras y espacios. No puede contener números ni caracteres especiales."
                               oninput="validateNombres(this)" required>
                        <span asp-validation-for="Nombres" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label for="fechaNacimiento">Fecha de Nacimiento</label>
                        <input asp-for="FechaNacimiento"
                               type="date"
                               class="form-control"
                               id="fechaNacimiento"
                               min="1950-01-01"
                               max="2006-12-31"
                               required />
                        <span asp-validation-for="FechaNacimiento" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label for="mail">Mail</label>
                        <input asp-for="Mail" type="email" class="form-control" id="mail" placeholder="Mail">
                        <span asp-validation-for="Mail" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label for="telefono">Teléfono</label>
                        <input type="text" name="Telefono" class="form-control" id="telefono" value="@Model.Telefono" placeholder="Teléfono" maxlength="10"
                               pattern="\d{1,10}" title="El teléfono debe contener solo números y debe tener hasta 10 dígitos."
                               oninput="this.value = this.value.replace(/\D/g, '')" required>
                        <span asp-validation-for="Telefono" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label for="direccion">Dirección</label>
                        <input asp-for="Direccion" class="form-control" id="direccion" placeholder="Dirección" maxlength="200">
                        <span asp-validation-for="Direccion" class="text-danger"></span>
                    </div>

                    <div class="form-check">
                        <input asp-for="Estado" id="estado" type="checkbox" class="form-check-input">
                        <label class="form-check-label" asp-for="Estado">Estado</label>
                    </div>

                    <div class="form-group">
                        <label for="saldo">Saldo</label>
                        <input asp-for="Saldo" class="form-control" id="saldo" placeholder="Saldo" type="float" step="0.01" min="0" value="0" readonly>
                        <span asp-validation-for="Saldo" class="text-danger"></span>
                    </div>
                </div>

                <div class="card-footer">
                    <button type="submit" class="btn btn-success btn-sm">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </div>
        </div>
        <div class="text-center mt-3">
            <a asp-action="Index" class="btn btn-secondary"><< Regresar</a>
        </div>
    </section>
</form>

<script type="text/javascript">
    function generarCedula() {
        const provincia = document.getElementById("provincia").value;
        if (provincia !== "") {
            let cedula = provincia;

            // Genera los siguientes 6 dígitos aleatorios
            for (let i = 0; i < 6; i++) {
                cedula += Math.floor(Math.random() * 10);
            }

            // Genera el séptimo dígito de género (1-5 masculino, 6-0 femenino)
            cedula += Math.floor(Math.random() * 10);

            // Calcula el dígito verificador
            let total = 0;
            for (let i = 0; i < 9; i++) {
                let digit = parseInt(cedula.charAt(i));
                if (i % 2 === 0) { // Posiciones impares (0-indexed)
                    digit *= 2;
                    if (digit > 9) digit -= 9; // Ajuste si el número es mayor a 9
                }
                total += digit;
            }
            const verificador = (10 - (total % 10)) % 10; // Dígito verificador
            cedula += verificador;

            // Asigna el valor a los campos visibles
            document.getElementById("cedula").value = cedula;
        } else {
            // Limpia el campo si no se selecciona provincia
            document.getElementById("cedula").value = "";
        }
    }
</script>

<script>
    function validateApellidos(input) {
        // Reemplaza cualquier carácter que no sea letra o espacio
        input.value = input.value.replace(/[^A-Za-z\s]/g, '');
    }

    function validateNombres(input) {
        // Reemplaza cualquier carácter que no sea letra o espacio
        input.value = input.value.replace(/[^A-Za-z\s]/g, '');
    }
</script>
